LEMP

1. Nginx
    apt install nginx
        방화벽 사용시 ufw allow 'Nginx Full'
        Nginx를 시작합니다.
        systemctl start nginx
        Nginx를 멈춥니다.
        systemctl stop nginx
        Nginx를 재시작합니다.
        systemctl restart nginx
        Nginx를 다시 로드합니다.
        systemctl reload nginx
        Nginx를 설치하면 부팅 시 자동으로 시작하게 설정됩니다. 만약 자동 시작을 해제하고 싶다면 다음과 같이 명령합니다.
        systemctl disable nginx
        자동 시작하도록 하려면 다음과 같이 명령합니다.
        systemctl enable nginx
	동작 확인
	systemctl status nginx
2. PHP
    apt install php-fpm
        etc/nginx/sites-available/default 파일을 열고 다음 코드를 찾습니다.
        #location ~ \.php$ {
        #	include snippets/fastcgi-php.conf;
        #
        #	# With php-fpm (or other unix sockets):
        #	fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;
        #	# With php-cgi (or other tcp sockets):
        #	fastcgi_pass 127.0.0.1:9000;
        #}
        다음처럼 바꿉니다.(7.0을 7.2로 바꾸었는데, 설치한 PHP 버전에 맞춥니다.)
        location ~ \.php$ {
          include snippets/fastcgi-php.conf;
        #
        #	# With php-fpm (or other unix sockets):
          fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
        #	# With php-cgi (or other tcp sockets):
        #	fastcgi_pass 127.0.0.1:9000;
        }
        index.php를 자동 인식하게 하려면
        index index.html index.htm index.nginx-debian.html;
        에 index.php를 추가합니다.
        index index.html index.htm index.nginx-debian.html index.php;
        Nginx를 다시 로드 해야 적용됩니다.
        service nginx reload
        테스트
        /var/www/html/ 디렉토리에 phpinfo.php를 만들고 다음 코드를 입력하고 저장합니다.
        <?php phpinfo(); ?>
3. MariaDB
    apt install mariadb-server php-mysql
        다음과 같이 명령하여 root 계정 비밀번호 등 몇 가지를 설정합니다.
        mysql_secure_installation
        웹에서 root 계정을 사용할 수 있게 하려면 수정해야 합니다. MariaDB에 접속합니다.
        mysql -uroot -p
        다음을 차례대로 입력합니다.
        use mysql;
        update user set plugin='' where user='root';
        flush privileges;
        quit;
        외부에서 MariaDB에 접속하고 싶다면 /etc/mysql/mariadb.conf.d/50-server.cnf에 있는
        bind-address = 127.0.0.1
        를 주석처리하거나 삭제합니다. 그리고 MariaDB를 재시작합니다.
        service mysql restart
            ***
            ubuntu같은 일부 리눅스 시스템에서 mysql을 설치하고 
            $ mysql -u root -p 으로 로그인 시도를하면 
            'ERROR 1698 (28000): Access denied for user 'root'@'localhost'이라는 에러를 발생할때가 있다.
            (phpMyAdmin에서 접속할 때도 같은 문제가 발생한다.)
            이는 기본적으로 초기설정되어있는 mysql의 root 계정의 패스워드 타입때문인데 
            $ sudo mysql -u root # sudo를 사용하여 root계정으로 mysql에 접속한다. 
            mysql> USE mysql;
            mysql> SELECT User, Host, plugin FROM mysql.user;
            +------------------+-----------------------+
            | User             | plugin                |
            +------------------+-----------------------+
            | root             | auth_socket           |
            | mysql.sys        | mysql_native_password |
            | debian-sys-maint | mysql_native_password |
            +------------------+-----------------------+
            위처럼 root의 plugin이 auth_socket으로 설정되어있는것을 확인할 수 있다.
            이 값을 mysql_native_password로 변경해주면 일반적인 로그인이 가능하다.
            mysql> update user set plugin='mysql_native_password' where user='root';
            mysql> flush privileges;
	전체백업	mysqldump -u [아이디] -p[패스워드] --all-databases > [백업파일명].sql
	전체복구	mysql -u [아이디] -p[패스워드] < [백업파일명].sql
	특정데이터베이스백업	mysqldump -u [아이디] -p[패스워드] [데이터베이스명] > [백업파일명].sql
	특정데이터베이스복구	mysql -u [아이디] -p[패스워드] [데이터베이스명] < [백업파일명].sql
4. phpMyAdmin
    apt install phpmyadmin
    sudo ln -s /usr/share/phpmyadmin /var/www/html
    sudo systemctl restart nginx OR sudo service nginx restart 
        ***
        phpmyadmin - count(): Parameter must be an array or an object that implements Countable
        Edit file /usr/share/phpmyadmin/libraries/sql.lib.php using this command:
        sudo nano +613 /usr/share/phpmyadmin/libraries/sql.lib.php
        On line 613 the count function always evaluates to true since there is no closing parenthesis after $analyzed_sql_results['select_expr']. Making the below replacements resolves this, then you will need to delete the last closing parenthesis on line 614, as it's now an extra parenthesis.
        Replace:
        ((empty($analyzed_sql_results['select_expr']))
            || (count($analyzed_sql_results['select_expr'] == 1)
                && ($analyzed_sql_results['select_expr'][0] == '*')))
        With:
        ((empty($analyzed_sql_results['select_expr']))
            || (count($analyzed_sql_results['select_expr']) == 1)
                && ($analyzed_sql_results['select_expr'][0] == '*'))

---
리눅스 / 명령어 / systemctl
서비스 관리
service_name은 서비스 이름으로 바꾸어 사용합니다. 예를 들어 Apache라면 httpd, MariaDB라면 mariadb
서비스 상태 확인
systemctl status service_name.service
서비스 시작
systemctl start service_name.service
서비스 재시작
systemctl restart service_name.service
서비스 중지
systemctl stop service_name.service
부팅 시 서비스 자동 시작
systemctl enable service_name.service
부팅 시 서비스 자동 시작 해제
systemctl disable service_name.service
서비스 목록 보기
systemctl list-units --type=service
---
방화벽
sudo ufw enable    sudo ufw status verbose
sudo ufw allow 'Nginx HTTP'
webmin 설치 후    sudo ufw allow 10000    https://localhost:10000
---
sudo apt install vsftpd
sudo micro /etc/vsftpd.conf
	listen=NO
	anonymous_enable=NO
	local_enable=YES
	write_enable=YES
	local_umask=022
	utf8_filesystem=YES
sudo systemctl start vsftpd (sudo systemctl enable vsftpd)
sudo ufw allow ftp (sudo ufw delete allow ftp)
android cx파일탐색기 네트워크-ftp - 모드 active로 설정 후 연결
---
